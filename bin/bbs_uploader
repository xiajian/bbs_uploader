#!/usr/bin/env ruby

require 'json'
require 'psych'
require 'optparse'
require 'bundler/setup'
require 'bbs_uploader'

options = {}

OptionParser.new do |opts|
  opts.banner = "Usage: bbs_uploader [options]"

  opts.on_tail('-h', '--help', 'Show this message') do
    puts opts
    exit
  end

  opts.on_tail('-v', '--version', 'Print version') do
    puts "bbs_uploader #{BbsUploader::VERSION}"
    exit
  end

  opts.on('-i', '--input-file [file]', 'Default: xxx.jpg') do |file|
    unless File.exist? file
      puts "输入的文件 #{file} 不存在，请检查后重试"
      exit
    end

    options[:input_file] = File.absolute_path file
  end
end.parse!

if options[:input_file].nil?
  file = ARGV[0]

  if !file.nil? && File.exists?(file)
    options[:input_file] = File.absolute_path file
  elsif !file.nil?
    puts "输入的文件 #{ARGV[0]} 不存在，请检查后重试"
    exit
  elsif file.nil?
    puts "没有选择上传的图片"
    exit
  end
end

BbsUploader.upload_image options[:input_file]